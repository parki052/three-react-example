{"ast":null,"code":"'use strict';\n\nconst pump = require('pump');\n\nconst bufferStream = require('./buffer-stream');\n\nclass MaxBufferError extends Error {\n  constructor() {\n    super('maxBuffer exceeded');\n    this.name = 'MaxBufferError';\n  }\n\n}\n\nfunction getStream(inputStream, options) {\n  if (!inputStream) {\n    return Promise.reject(new Error('Expected a stream'));\n  }\n\n  options = Object.assign({\n    maxBuffer: Infinity\n  }, options);\n  const _options = options,\n        maxBuffer = _options.maxBuffer;\n  let stream;\n  return new Promise((resolve, reject) => {\n    const rejectPromise = error => {\n      if (error) {\n        // A null check\n        error.bufferedData = stream.getBufferedValue();\n      }\n\n      reject(error);\n    };\n\n    stream = pump(inputStream, bufferStream(options), error => {\n      if (error) {\n        rejectPromise(error);\n        return;\n      }\n\n      resolve();\n    });\n    stream.on('data', () => {\n      if (stream.getBufferedLength() > maxBuffer) {\n        rejectPromise(new MaxBufferError());\n      }\n    });\n  }).then(() => stream.getBufferedValue());\n}\n\nmodule.exports = getStream;\n\nmodule.exports.buffer = (stream, options) => getStream(stream, Object.assign({}, options, {\n  encoding: 'buffer'\n}));\n\nmodule.exports.array = (stream, options) => getStream(stream, Object.assign({}, options, {\n  array: true\n}));\n\nmodule.exports.MaxBufferError = MaxBufferError;","map":null,"metadata":{},"sourceType":"script"}